@using ProjetMVC.Enums;
@using ProjetMVC.ViewModels;
@model BorneDisponibilitesViewModel

<div class="container">
    <div class="card-favorites-borne position-relative">
        <h1 class="card-title-favorites-borne">Disponibilités de la borne @Model.BorneId</h1>

        <div class="table-responsive">
            <table class="table table-disponibilites table-borne">
                <thead>
                    <tr>
                        <th>Date et heure de début</th>
                        <th>Date et heure de fin</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var disponibilite in Model.Disponibilites)
                    {
                        <tr>
                            <td>@disponibilite.DateDebut.ToString("dd/MM/yyyy HH:mm")</td>
                            <td>@disponibilite.DateFin.ToString("dd/MM/yyyy HH:mm")</td>
                            <td>
                                @if (User.Identity.IsAuthenticated)
                                {
                                    @if (Model.UtilisateurEstProprietaire)
                                    {
                                        <form asp-action="ModifierDisponibilite" method="get" class="d-inline-block">
                                            <input type="hidden" name="id" value="@disponibilite.DisponibiliteId" />
                                            <input type="hidden" name="borneId" value="@Model.BorneId" />
                                            <button type="submit" class="btn btn-primary"><i class="fas fa-edit"></i> Modifier</button>
                                        </form>
                                        <form asp-action="SupprimerDisponibilite" method="post" class="d-inline-block">
                                            <input type="hidden" name="id" value="@disponibilite.DisponibiliteId" />
                                            <input type="hidden" name="borneId" value="@Model.BorneId" />
                                            <button type="submit" class="btn btn-danger"> <i class="fas fa-trash-alt fa-sm"></i> Supprimer</button>
                                        </form>
                                    }
                                    else
                                    {
                                        <form asp-action="ReserverDisponibilite" method="post" class="d-inline-block">
                                            <input type="hidden" name="disponibiliteId" value="@disponibilite.DisponibiliteId" />
                                            <input type="hidden" name="borneId" value="@Model.BorneId" />
                                            <button type="submit" class="btn btn-success btn-reserve" onclick="return false;"><i class="fas fa-calendar-check"></i> Réserver</button>
                                        </form>
                                    }
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        @if (User.Identity.IsAuthenticated && Model.UtilisateurEstProprietaire)
        {
            <form asp-action="AjouterDisponibilite" method="post">
                <input type="hidden" name="borneId" value="@Model.BorneId" />

                <div class="form-group">
                    <label for="dateDebut">Date de début</label>
                    <input type="datetime-local" id="dateDebut" name="dateDebut" class="form-control" required />
                </div>

                <button type="submit" class="btn btn-primary"><i class="fas fa-plus-circle"></i> Ajouter disponibilité</button>
            </form>
        }

        @if (TempData["ErrorMessage"] != null)
        {
            <div class="alert alert-danger mt-3">
                @TempData["ErrorMessage"]
            </div>
        }

        @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert alert-success mt-3">
                @TempData["SuccessMessage"]
            </div>
        }
        <div id="pagination" class="pagination-container mt-3"></div>
    </div>
    <div class="d-flex justify-content-center mt-5 retour-liste-container">
        <a class="btn btn-secondary" asp-action="Index">
            <i class="fas fa-arrow-left"></i> Retour à la Liste
        </a>
    </div>
</div>
